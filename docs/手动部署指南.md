# ğŸš€ æ–°æœåŠ¡å™¨æ‰‹åŠ¨éƒ¨ç½²æŒ‡å—

## ğŸ“‹ æœåŠ¡å™¨ä¿¡æ¯
- **IP**: 192.168.1.215
- **ç”¨æˆ·**: dev  
- **å¯†ç **: 123
- **ç³»ç»Ÿ**: Ubuntu (å…¨æ–°å®‰è£…)

---

## ğŸ—ï¸ ç¬¬ä¸€é˜¶æ®µï¼šæœåŠ¡å™¨åŸºç¡€ç¯å¢ƒå‡†å¤‡

### 1. è¿æ¥åˆ°æœåŠ¡å™¨
```bash
# ä»æœ¬åœ°æœºå™¨è¿æ¥
ssh dev@192.168.1.215
```

### 2. æ‰§è¡ŒæœåŠ¡å™¨è®¾ç½®è„šæœ¬
```bash
# åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºå¹¶è¿è¡Œè®¾ç½®è„šæœ¬
cat > setup-server.sh << 'EOF'
#!/bin/bash
set -e

echo "ğŸš€ å¼€å§‹æœåŠ¡å™¨ç¯å¢ƒè®¾ç½®..."

# æ›´æ–°ç³»ç»Ÿ
sudo apt update -y && sudo apt upgrade -y

# å®‰è£…åŸºç¡€å·¥å…·
sudo apt install -y curl wget git vim htop tree unzip build-essential software-properties-common

# å®‰è£…Python 3.11
sudo add-apt-repository ppa:deadsnakes/ppa -y
sudo apt update
sudo apt install -y python3.11 python3.11-venv python3.11-dev python3-pip
sudo update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.11 1

# å®‰è£…PostgreSQL
sudo apt install -y postgresql postgresql-contrib
sudo systemctl start postgresql
sudo systemctl enable postgresql
sudo -u postgres psql -c "ALTER USER postgres PASSWORD '123456';"
sudo -u postgres createdb project_ledger

# å®‰è£…Redis
sudo apt install -y redis-server
sudo systemctl start redis-server
sudo systemctl enable redis-server

# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir -p /home/dev/project-ledger/{backend,frontend,logs,uploads}

echo "âœ… æœåŠ¡å™¨ç¯å¢ƒè®¾ç½®å®Œæˆï¼"
EOF

# ç»™è„šæœ¬æ‰§è¡Œæƒé™å¹¶è¿è¡Œ
chmod +x setup-server.sh
./setup-server.sh
```

---

## ğŸ“¦ ç¬¬äºŒé˜¶æ®µï¼šä¸Šä¼ é¡¹ç›®ä»£ç 

### 1. åœ¨æœ¬åœ°æœºå™¨ä¸Šæ‰“åŒ…ä»£ç 
```powershell
# åœ¨ C:\Users\1\Desktop\å·¥ç¨‹é¡¹ç›®æµæ°´è´¦ ç›®å½•ä¸‹æ‰§è¡Œ
tar -czf project-complete.tar.gz --exclude=.git --exclude=node_modules --exclude=__pycache__ --exclude=*.pyc --exclude=venv --exclude=*.tar.gz .
```

### 2. ä¸Šä¼ åˆ°æœåŠ¡å™¨
```powershell
# ä¸Šä¼ ä»£ç åŒ…
scp project-complete.tar.gz dev@192.168.1.215:~/
```

### 3. åœ¨æœåŠ¡å™¨ä¸Šè§£å‹ä»£ç 
```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
cd /home/dev/project-ledger
tar -xzf ~/project-complete.tar.gz

# æ£€æŸ¥æ–‡ä»¶ç»“æ„
ls -la
```

---

## ğŸ ç¬¬ä¸‰é˜¶æ®µï¼šPythonç¯å¢ƒé…ç½®

### 1. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
```bash
cd /home/dev/project-ledger/backend
python3 -m venv venv
source venv/bin/activate

# éªŒè¯Pythonç‰ˆæœ¬
python --version  # åº”è¯¥æ˜¾ç¤ºPython 3.11.x
```

### 2. åˆ›å»ºç¯å¢ƒé…ç½®æ–‡ä»¶
```bash
cat > .env << 'EOF'
APP_NAME=å·¥ç¨‹é¡¹ç›®æµæ°´è´¦ç®¡ç†ç³»ç»Ÿ
DEBUG=true
DATABASE_URL=postgresql+asyncpg://postgres:123456@localhost:5432/project_ledger
DATABASE_URL_SYNC=postgresql://postgres:123456@localhost:5432/project_ledger
REDIS_URL=redis://localhost:6379/0
SECRET_KEY=dev-secret-key-change-in-production-1234567890
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7
ENCRYPTION_KEY=dev-encryption-key-change-in-production
ENCRYPTION_SALT=dev-salt-change-in-production
UPLOAD_DIR=/home/dev/project-ledger/uploads
MAX_FILE_SIZE=10485760
LOG_LEVEL=INFO
LOG_FILE=/home/dev/project-ledger/logs/app.log
DEFAULT_STORAGE_LIMIT=5368709120
DEFAULT_API_CALLS_LIMIT=10000
EOF
```

### 3. å®‰è£…Pythonä¾èµ–
```bash
# ç¡®ä¿åœ¨è™šæ‹Ÿç¯å¢ƒä¸­
source venv/bin/activate

# å‡çº§pip
pip install --upgrade pip

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å¦‚æœé‡åˆ°é”™è¯¯ï¼Œé€ä¸ªå®‰è£…æ ¸å¿ƒä¾èµ–
pip install fastapi uvicorn sqlalchemy asyncpg alembic python-jose[cryptography] passlib[bcrypt] python-multipart pydantic pydantic-settings
```

---

## ğŸ—„ï¸ ç¬¬å››é˜¶æ®µï¼šæ•°æ®åº“åˆå§‹åŒ–

### 1. éªŒè¯æ•°æ®åº“è¿æ¥
```bash
# æµ‹è¯•PostgreSQLè¿æ¥
psql postgresql://postgres:123456@localhost:5432/project_ledger -c "SELECT 1;"
```

### 2. è¿è¡Œæ•°æ®åº“è¿ç§»
```bash
cd /home/dev/project-ledger/backend
source venv/bin/activate

# è¿è¡Œè¿ç§»
alembic upgrade head

# éªŒè¯è¡¨åˆ›å»º
python3 -c "
import asyncio
from sqlalchemy import text
from app.core.database import database_manager

async def check_tables():
    async with database_manager.get_session() as session:
        result = await session.execute(text('SELECT tablename FROM pg_tables WHERE schemaname = \\'public\\';'))
        tables = result.fetchall()
        print('æ•°æ®åº“è¡¨:', [table[0] for table in tables])

asyncio.run(check_tables())
"
```

---

## ğŸš€ ç¬¬äº”é˜¶æ®µï¼šå¯åŠ¨APIæœåŠ¡å™¨

### 1. æµ‹è¯•å¯åŠ¨
```bash
cd /home/dev/project-ledger/backend
source venv/bin/activate

# å‰å°å¯åŠ¨æµ‹è¯•
uvicorn app.main:app --host 0.0.0.0 --port 8000

# å¦‚æœå¯åŠ¨æˆåŠŸï¼ŒæŒ‰Ctrl+Cåœæ­¢
```

### 2. åå°å¯åŠ¨
```bash
# åå°å¯åŠ¨APIæœåŠ¡å™¨
nohup uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload > ../logs/api.log 2>&1 &

# æ£€æŸ¥è¿›ç¨‹
ps aux | grep uvicorn

# æŸ¥çœ‹æ—¥å¿—
tail -f /home/dev/project-ledger/logs/api.log
```

---

## ğŸ§ª ç¬¬å…­é˜¶æ®µï¼šåŠŸèƒ½æµ‹è¯•

### 1. åŸºç¡€å¥åº·æ£€æŸ¥
```bash
# åœ¨æœåŠ¡å™¨ä¸Šæµ‹è¯•
curl http://localhost:8000/health

# ä»å¤–éƒ¨æµ‹è¯•ï¼ˆåœ¨æœ¬åœ°æœºå™¨ä¸Šï¼‰
curl http://192.168.1.215:8000/health
```

### 2. APIæ–‡æ¡£æ£€æŸ¥
```bash
# æ£€æŸ¥APIæ–‡æ¡£
curl http://192.168.1.215:8000/docs
```

### 3. ç§Ÿæˆ·æ³¨å†Œæµ‹è¯•
```bash
curl -X POST "http://192.168.1.215:8000/api/v1/auth/register" \
     -H "Content-Type: application/json" \
     -d '{
       "company_name": "æµ‹è¯•å»ºç­‘å…¬å¸",
       "industry_type": "construction", 
       "company_size": "small",
       "admin_name": "å¼ ä¸‰",
       "admin_email": "admin@test.com",
       "admin_phone": "13800138000",
       "password": "123456",
       "confirm_password": "123456"
     }'
```

### 4. ç™»å½•æµ‹è¯•
```bash
curl -X POST "http://192.168.1.215:8000/api/v1/auth/login" \
     -H "Content-Type: application/json" \
     -d '{
       "email": "admin@test.com",
       "password": "123456"
     }'

# ä¿å­˜è¿”å›çš„access_token
```

### 5. ç”¨æˆ·ç®¡ç†APIæµ‹è¯•
```bash
# ä½¿ç”¨ä¸Šé¢è·å¾—çš„token
TOKEN="your_access_token_here"

# è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
curl -H "Authorization: Bearer $TOKEN" \
     "http://192.168.1.215:8000/api/v1/users/me"

# è·å–ç”¨æˆ·åˆ—è¡¨
curl -H "Authorization: Bearer $TOKEN" \
     "http://192.168.1.215:8000/api/v1/users/"

# åˆ›å»ºæ–°ç”¨æˆ·
curl -X POST "http://192.168.1.215:8000/api/v1/users/" \
     -H "Authorization: Bearer $TOKEN" \
     -H "Content-Type: application/json" \
     -d '{
       "username": "æå››",
       "email": "lisi@test.com", 
       "password": "123456",
       "role": "finance",
       "permissions": ["transaction_read", "transaction_create"],
       "is_active": true
     }'

# è·å–ç”¨æˆ·ç»Ÿè®¡
curl -H "Authorization: Bearer $TOKEN" \
     "http://192.168.1.215:8000/api/v1/users/statistics"
```

---

## ğŸ”§ æ•…éšœæ’é™¤

### 1. æœåŠ¡æ£€æŸ¥å‘½ä»¤
```bash
# æ£€æŸ¥PostgreSQLçŠ¶æ€
sudo systemctl status postgresql

# æ£€æŸ¥RedisçŠ¶æ€  
sudo systemctl status redis-server

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tulpn | grep 8000

# æ£€æŸ¥APIè¿›ç¨‹
ps aux | grep uvicorn
```

### 2. æ—¥å¿—æŸ¥çœ‹
```bash
# APIæ—¥å¿—
tail -f /home/dev/project-ledger/logs/api.log

# PostgreSQLæ—¥å¿—
sudo tail -f /var/log/postgresql/postgresql-*-main.log

# ç³»ç»Ÿæ—¥å¿—
sudo journalctl -f
```

### 3. å¸¸è§é—®é¢˜è§£å†³
```bash
# å¦‚æœç«¯å£è¢«å ç”¨
sudo lsof -i :8000
sudo kill -9 <PID>

# å¦‚æœæ•°æ®åº“è¿æ¥å¤±è´¥
sudo systemctl restart postgresql
psql postgresql://postgres:123456@localhost:5432/project_ledger -c "SELECT 1;"

# å¦‚æœPythonä¾èµ–å®‰è£…å¤±è´¥
pip install --upgrade pip setuptools wheel
pip install -r requirements.txt --no-cache-dir
```

---

## âœ… éƒ¨ç½²æˆåŠŸéªŒè¯æ¸…å•

- [ ] æœåŠ¡å™¨è¿æ¥æˆåŠŸ
- [ ] Python 3.11å®‰è£…å®Œæˆ
- [ ] PostgreSQLå®‰è£…å¹¶é…ç½®
- [ ] Rediså®‰è£…å¹¶è¿è¡Œ
- [ ] é¡¹ç›®ä»£ç ä¸Šä¼ æˆåŠŸ
- [ ] è™šæ‹Ÿç¯å¢ƒåˆ›å»ºæˆåŠŸ
- [ ] ä¾èµ–å®‰è£…å®Œæˆ
- [ ] ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®
- [ ] æ•°æ®åº“è¿ç§»æˆåŠŸ
- [ ] APIæœåŠ¡å™¨å¯åŠ¨æˆåŠŸ
- [ ] å¥åº·æ£€æŸ¥é€šè¿‡ âœ…
- [ ] ç§Ÿæˆ·æ³¨å†ŒæˆåŠŸ âœ…
- [ ] ç”¨æˆ·ç™»å½•æˆåŠŸ âœ…
- [ ] ç”¨æˆ·ç®¡ç†APIæµ‹è¯•é€šè¿‡ âœ…

## ğŸ¯ éƒ¨ç½²å®Œæˆæ ‡å¿—

å½“æ‰€æœ‰æµ‹è¯•é€šè¿‡æ—¶ï¼Œæ‚¨å°†æ‹¥æœ‰ï¼š

1. **å®Œæ•´çš„APIæœåŠ¡**: http://192.168.1.215:8000
2. **APIæ–‡æ¡£é¡µé¢**: http://192.168.1.215:8000/docs  
3. **ç”¨æˆ·ç®¡ç†åŠŸèƒ½**: å®Œæ•´çš„CRUDæ“ä½œ
4. **æ•°æ®åº“å’Œç¼“å­˜**: PostgreSQL + Redisæ­£å¸¸è¿è¡Œ
5. **ä¸ºä¸‹ä¸€é˜¶æ®µå¼€å‘åšå¥½å‡†å¤‡**: é¡¹ç›®ç®¡ç†APIã€è´¢åŠ¡è®°å½•APIç­‰

## ğŸ“ éœ€è¦å¸®åŠ©æ—¶

å¦‚æœé‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·ï¼š
1. æ£€æŸ¥å¯¹åº”çš„æ—¥å¿—æ–‡ä»¶
2. ç¡®è®¤æœåŠ¡çŠ¶æ€
3. éªŒè¯ç½‘ç»œè¿æ¥
4. è”ç³»æŠ€æœ¯æ”¯æŒ

ğŸ‰ **éƒ¨ç½²æˆåŠŸåï¼Œæ‚¨å°±æœ‰äº†ä¸€ä¸ªå®Œæ•´å¯ç”¨çš„å·¥ç¨‹é¡¹ç›®æµæ°´è´¦ç®¡ç†ç³»ç»Ÿåç«¯æœåŠ¡ï¼**
