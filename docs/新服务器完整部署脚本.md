# æ–°æœåŠ¡å™¨å®Œæ•´éƒ¨ç½²è„šæœ¬

## ğŸ¯ æœåŠ¡å™¨ä¿¡æ¯
- **IPåœ°å€**: 192.168.1.215
- **ç”¨æˆ·å**: dev
- **å¯†ç **: 123
- **ç³»ç»Ÿ**: Ubuntu (å…¨æ–°)

## ğŸ“‹ éƒ¨ç½²æ­¥éª¤æ¸…å•

### ç¬¬1æ­¥ï¼šè¿æ¥æœåŠ¡å™¨å¹¶æ£€æŸ¥ç³»ç»Ÿ
```bash
# è¿æ¥åˆ°æœåŠ¡å™¨
ssh dev@192.168.1.215

# æ£€æŸ¥ç³»ç»Ÿä¿¡æ¯
whoami
pwd
uname -a
df -h
free -h
```

### ç¬¬2æ­¥ï¼šæ›´æ–°ç³»ç»Ÿå¹¶å®‰è£…åŸºç¡€å·¥å…·
```bash
# æ›´æ–°ç³»ç»ŸåŒ…
sudo apt update && sudo apt upgrade -y

# å®‰è£…åŸºç¡€å·¥å…·
sudo apt install -y curl wget git vim htop tree unzip

# å®‰è£…Python 3.11å’Œç›¸å…³å·¥å…·
sudo apt install -y python3.11 python3.11-venv python3.11-dev python3-pip

# è®¾ç½®Python3.11ä¸ºé»˜è®¤python3
sudo update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.11 1
```

### ç¬¬3æ­¥ï¼šå®‰è£…Dockerå’ŒDocker Compose
```bash
# å®‰è£…Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# å°†ç”¨æˆ·æ·»åŠ åˆ°dockerç»„
sudo usermod -aG docker $USER

# å®‰è£…Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# éªŒè¯å®‰è£…
docker --version
docker-compose --version
```

### ç¬¬4æ­¥ï¼šå®‰è£…PostgreSQLå’ŒRedis
```bash
# å®‰è£…PostgreSQL
sudo apt install -y postgresql postgresql-contrib

# å¯åŠ¨PostgreSQLæœåŠ¡
sudo systemctl start postgresql
sudo systemctl enable postgresql

# è®¾ç½®PostgreSQLå¯†ç 
sudo -u postgres psql -c "ALTER USER postgres PASSWORD '123456';"

# åˆ›å»ºæ•°æ®åº“
sudo -u postgres createdb project_ledger

# å®‰è£…Redis
sudo apt install -y redis-server

# å¯åŠ¨RedisæœåŠ¡
sudo systemctl start redis-server
sudo systemctl enable redis-server
```

### ç¬¬5æ­¥ï¼šåˆ›å»ºé¡¹ç›®ç›®å½•å¹¶ä¸Šä¼ ä»£ç 
```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir -p /home/dev/project-ledger
cd /home/dev/project-ledger

# åˆ›å»ºå¿…è¦çš„å­ç›®å½•
mkdir -p backend frontend logs uploads
```

**åœ¨æœ¬åœ°æœºå™¨ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä¸Šä¼ ä»£ç ï¼š**
```powershell
# æ‰“åŒ…å®Œæ•´é¡¹ç›®ä»£ç 
tar -czf project-complete.tar.gz --exclude=.git --exclude=node_modules --exclude=__pycache__ --exclude=*.pyc --exclude=venv --exclude=*.tar.gz .

# ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp project-complete.tar.gz dev@192.168.1.215:~/

# SSHåˆ°æœåŠ¡å™¨è§£å‹
ssh dev@192.168.1.215
cd /home/dev/project-ledger
tar -xzf ~/project-complete.tar.gz
```

### ç¬¬6æ­¥ï¼šè®¾ç½®åç«¯ç¯å¢ƒ
```bash
cd /home/dev/project-ledger/backend

# åˆ›å»ºPythonè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate

# å‡çº§pip
pip install --upgrade pip

# å®‰è£…Pythonä¾èµ–
pip install -r requirements.txt

# åˆ›å»ºç¯å¢ƒé…ç½®æ–‡ä»¶
cat > .env << EOF
APP_NAME=å·¥ç¨‹é¡¹ç›®æµæ°´è´¦ç®¡ç†ç³»ç»Ÿ
DEBUG=true
DATABASE_URL=postgresql+asyncpg://postgres:123456@localhost:5432/project_ledger
DATABASE_URL_SYNC=postgresql://postgres:123456@localhost:5432/project_ledger
REDIS_URL=redis://localhost:6379/0
SECRET_KEY=your-secret-key-here-change-in-production
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7
ENCRYPTION_KEY=your-encryption-key-here
UPLOAD_DIR=/home/dev/project-ledger/uploads
EOF
```

### ç¬¬7æ­¥ï¼šåˆå§‹åŒ–æ•°æ®åº“
```bash
# åœ¨backendç›®å½•ä¸‹
cd /home/dev/project-ledger/backend
source venv/bin/activate

# è¿è¡Œæ•°æ®åº“è¿ç§»
alembic upgrade head

# éªŒè¯æ•°æ®åº“è¡¨åˆ›å»º
python3 -c "
import asyncio
from sqlalchemy import text
from app.core.database import database_manager

async def check_tables():
    async with database_manager.get_session() as session:
        result = await session.execute(text('SELECT tablename FROM pg_tables WHERE schemaname = \\'public\\';'))
        tables = result.fetchall()
        print('Created tables:', [table[0] for table in tables])

asyncio.run(check_tables())
"
```

### ç¬¬8æ­¥ï¼šå¯åŠ¨APIæœåŠ¡å™¨
```bash
cd /home/dev/project-ledger/backend
source venv/bin/activate

# å‰å°å¯åŠ¨æµ‹è¯•ï¼ˆç¡®ä¿æ²¡æœ‰é”™è¯¯ï¼‰
uvicorn app.main:app --host 0.0.0.0 --port 8000

# å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œåœæ­¢å¹¶åå°å¯åŠ¨
# Ctrl+C åœæ­¢
nohup uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload > ../logs/api.log 2>&1 &
```

### ç¬¬9æ­¥ï¼šéªŒè¯æœåŠ¡
```bash
# æ£€æŸ¥APIæœåŠ¡çŠ¶æ€
curl http://localhost:8000/health

# æ£€æŸ¥APIæ–‡æ¡£
curl http://localhost:8000/docs

# ä»å¤–éƒ¨è®¿é—®æµ‹è¯•
curl http://192.168.1.215:8000/health
```

### ç¬¬10æ­¥ï¼šè®¾ç½®é˜²ç«å¢™ï¼ˆå¦‚æœéœ€è¦ï¼‰
```bash
# æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
sudo ufw status

# å¦‚æœé˜²ç«å¢™å¼€å¯ï¼Œå…è®¸8000ç«¯å£
sudo ufw allow 8000
sudo ufw allow ssh
```

## ğŸ§ª å®Œæ•´APIæµ‹è¯•

### æµ‹è¯•1ï¼šæ³¨å†Œç§Ÿæˆ·
```bash
curl -X POST "http://192.168.1.215:8000/api/v1/auth/register" \
     -H "Content-Type: application/json" \
     -d '{
       "company_name": "æµ‹è¯•å»ºç­‘å…¬å¸",
       "industry_type": "construction",
       "company_size": "small",
       "admin_name": "å¼ ä¸‰",
       "admin_email": "admin@test.com",
       "admin_phone": "13800138000",
       "password": "123456",
       "confirm_password": "123456"
     }'
```

### æµ‹è¯•2ï¼šç®¡ç†å‘˜ç™»å½•
```bash
curl -X POST "http://192.168.1.215:8000/api/v1/auth/login" \
     -H "Content-Type: application/json" \
     -d '{
       "email": "admin@test.com",
       "password": "123456"
     }'

# ä¿å­˜è¿”å›çš„token
export TOKEN="your_access_token_here"
```

### æµ‹è¯•3ï¼šæµ‹è¯•ç”¨æˆ·ç®¡ç†API
```bash
# è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
curl -H "Authorization: Bearer $TOKEN" \
     "http://192.168.1.215:8000/api/v1/users/me"

# åˆ›å»ºæ–°ç”¨æˆ·
curl -X POST "http://192.168.1.215:8000/api/v1/users/" \
     -H "Authorization: Bearer $TOKEN" \
     -H "Content-Type: application/json" \
     -d '{
       "username": "æå››",
       "email": "lisi@test.com",
       "password": "123456",
       "role": "finance",
       "permissions": ["transaction_read", "transaction_create"],
       "is_active": true
     }'

# è·å–ç”¨æˆ·åˆ—è¡¨
curl -H "Authorization: Bearer $TOKEN" \
     "http://192.168.1.215:8000/api/v1/users/"

# è·å–ç”¨æˆ·ç»Ÿè®¡
curl -H "Authorization: Bearer $TOKEN" \
     "http://192.168.1.215:8000/api/v1/users/statistics"
```

## ğŸ”§ é—®é¢˜æ’æŸ¥

### å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼š

#### 1. PostgreSQLè¿æ¥é—®é¢˜
```bash
# æ£€æŸ¥PostgreSQLçŠ¶æ€
sudo systemctl status postgresql

# é‡å¯PostgreSQL
sudo systemctl restart postgresql

# æ£€æŸ¥è¿æ¥
psql postgresql://postgres:123456@localhost:5432/project_ledger -c "SELECT 1;"
```

#### 2. Pythonä¾èµ–å®‰è£…é—®é¢˜
```bash
# å¦‚æœpipå®‰è£…å¤±è´¥ï¼Œå°è¯•
pip install --upgrade pip setuptools wheel
pip install -r requirements.txt --no-cache-dir
```

#### 3. æƒé™é—®é¢˜
```bash
# æ£€æŸ¥ç›®å½•æƒé™
ls -la /home/dev/project-ledger/
sudo chown -R dev:dev /home/dev/project-ledger/
```

#### 4. ç«¯å£å ç”¨é—®é¢˜
```bash
# æ£€æŸ¥8000ç«¯å£å ç”¨
netstat -tulpn | grep 8000
sudo lsof -i :8000

# æ€æ­»å ç”¨è¿›ç¨‹
sudo kill -9 <PID>
```

#### 5. APIå¯åŠ¨é”™è¯¯
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
cd /home/dev/project-ledger/backend
source venv/bin/activate
python -c "from app.main import app; print('Import successful')"

# æŸ¥çœ‹APIæ—¥å¿—
tail -f /home/dev/project-ledger/logs/api.log
```

## ğŸ“Š éƒ¨ç½²éªŒè¯æ¸…å•

- [ ] æœåŠ¡å™¨è¿æ¥æˆåŠŸ
- [ ] ç³»ç»Ÿæ›´æ–°å®Œæˆ
- [ ] Python 3.11å®‰è£…æˆåŠŸ
- [ ] Dockerå®‰è£…æˆåŠŸ
- [ ] PostgreSQLå®‰è£…å¹¶é…ç½®
- [ ] Rediså®‰è£…å¹¶è¿è¡Œ
- [ ] é¡¹ç›®ä»£ç ä¸Šä¼ æˆåŠŸ
- [ ] è™šæ‹Ÿç¯å¢ƒåˆ›å»ºæˆåŠŸ
- [ ] ä¾èµ–å®‰è£…å®Œæˆ
- [ ] æ•°æ®åº“è¿ç§»æˆåŠŸ
- [ ] APIæœåŠ¡å™¨å¯åŠ¨æˆåŠŸ
- [ ] å¥åº·æ£€æŸ¥é€šè¿‡
- [ ] ç§Ÿæˆ·æ³¨å†Œæµ‹è¯•é€šè¿‡
- [ ] ç”¨æˆ·ç™»å½•æµ‹è¯•é€šè¿‡
- [ ] ç”¨æˆ·ç®¡ç†APIæµ‹è¯•é€šè¿‡

## ğŸ¯ éƒ¨ç½²å®Œæˆæ ‡å¿—

å½“æ‰€æœ‰æµ‹è¯•é€šè¿‡åï¼Œæ‚¨å°†æœ‰ï¼š
1. âœ… å®Œæ•´çš„APIæœåŠ¡å™¨è¿è¡Œåœ¨ http://192.168.1.215:8000
2. âœ… å¯è®¿é—®çš„APIæ–‡æ¡£ http://192.168.1.215:8000/docs
3. âœ… å®Œæ•´çš„ç”¨æˆ·ç®¡ç†åŠŸèƒ½
4. âœ… æ•°æ®åº“å’Œç¼“å­˜æ­£å¸¸å·¥ä½œ
5. âœ… ä¸ºåç»­å¼€å‘åšå¥½å‡†å¤‡

è®©æˆ‘ä»¬å¼€å§‹æ‰§è¡Œè¿™ä¸ªéƒ¨ç½²è®¡åˆ’ï¼
